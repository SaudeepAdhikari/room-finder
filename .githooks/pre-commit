#!/bin/sh
# Prevent committing sensitive files (staged files check)
set -e
staged=$(git diff --cached --name-only)
for file in $staged; do
  base=$(basename "$file")
  # block any file named .env anywhere, and common key/cert file extensions
  if [ "$base" = ".env" ] || echo "$file" | grep -Eq '(^|/)\.env($|/)' || echo "$file" | grep -Eq '\.(pem|key|p12)$' ; then
    echo "\nERROR: Sensitive file staged: $file"
    echo "Remove it (git reset HEAD -- $file) and use .env.example. Aborting commit.\n"
    exit 1
  fi
done
exit 0
